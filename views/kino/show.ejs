<% layout('layouts/boilerplate') %>

<div id="delete-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <!-- Any other Bulma elements you want -->
      <div class="notification is-danger">
        <p>Are you sure you want to delete this cinema:</p>
        <p class="is-size-4 mt-2"><strong><%= cinema.name %></strong></pclass>
        <div class="buttons mt-5">
            <form action="/kino/<%= cinema._id %>?_method=DELETE" method="POST" class="mr-2">
                <button class="button is-dark">Yes</button>
            </form>
            <button class="button is-light modal-close-btn">No</button>
        </div>
      </div>
    </div>
    <button id="delete-modal-close" class="modal-close is-large modal-close-btn" aria-label="close"></button>
  </div>

<figure class="image is-3by1 mt-3">
    <img src="<%= cinema.image ? cinema.image : 'https://images.unsplash.com/photo-1574267432553-4b4628081c31?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2062&q=80' %>" alt="<%= cinema.name %>" class="hero-image">
</figure>

<div class="columns">
    <div class="column">
        <h1 class="title mt-6"><%= cinema.name %></h1>
    </div>
    <div class="column">
        <div class="content stars-holder">
            <% const ratings = cinema.reviews.map(review => review.rating); %>
            <% const rating = ratings.reduce((accumulator, currentValue) => accumulator + currentValue) / ratings.length; %>
            <div class="stars" style="--rating: <%= rating %>;--star-color:hsl(0, 0%, 71%);" aria-label="Rating of this movie theater is <%= rating %> out of 5.">
            </div>
        </div>
    </div>
</div>

<div class="buttons">
    <a href="/kino/<%= cinema._id %>/edit" class="button is-primary">Edit</a>
    <button id="delete-modal-open" class="button is-danger">Delete</button>
  </div>

<h2 class="title is-4 mt-6">Now showing:</h2>

<div class="columns is-multiline">
    <% for (let movie of movies) { %>
        <div class="column is-one-quarter">
            <a href="/kino/<%= cinema._id %>/movie/<%= movie._id %>" class="open-link">
                <div class="card open-card">
                    <div class="card-image open-image">
                        <div class="open-button">
                            <button class="button is-danger">Delete</button>
                        </div>
                    <figure class="image is-4by5">
                        <img src="<%= movie.image ? movie.image : 'https://images.unsplash.com/photo-1616530940355-351fabd9524b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=735&q=80' %>" class="cover-image open-effect">
                    </figure>
                    </div>
                    <div class="card-content">      
                    <div class="content">
                        <h2 class="title is-6"><%= movie.title %></h2>
                        <p><%= movie.duration %> min.</p>
                        <p><%= movie.genre %></p>
                    </div>
                    </div>
                </div>
            </a>    
        </div>
    <% } %>
    
</div>
<div class="columns">
    <div class="column is-one-quarter">
        <a class="button is-primary" href="/kino/<%= cinema._id %>/movie/">Add movie</a>
    </div>
</div>

<h2 class="title is-4 mt-6">Reviews:</h2>

<% for (let review of cinema.reviews) { %>
    <div class="box">
        <p class="is-inline"><strong><%= review.author %> - </strong></p>
        <div class="stars is-inline" style="--rating: <%= review.rating %>;--star-color:hsl(0, 0%, 71%);" aria-label="Rating of this movie theater is <%= review.rating %> out of 5."></div>
        <p><%= review.body %></p>
        <p class="has-text-weight-light"><%= review.date ? review.date : '01/01/2022' %></p>
    </div>
<% } %>

<footer class="footer mt-6">
    <div class="columns">
        <div class="column">
            <div class="content">
                <h2 class="title is-4">Contact:</h2>
                <p><%= cinema.location %></p>
                <p><a href="tel:<%= cinema.phone %>"><%= cinema.phone %></a></p>
                <p><a href="mailto:<%= cinema.email %>"><%= cinema.email %></a></p>
            </div>
        </div>
        <div class="column">
            <figure class="image is-5by4">
                <img src="https://images.unsplash.com/photo-1522678073884-26b1b87526e4?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2735&q=80" class="cover-image">
            </figure>
        </div>
    </div>
  </footer>